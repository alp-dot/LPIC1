# 基本的なファイル管理

## 1. gzipコマンド

gzipは、ファイルをGNU zip形式で圧縮・展開するためのコマンドです。

### 基本的な書式
```bash
gzip [オプション] [ファイル名]
```

### 主なオプション
- `-c`: 圧縮結果を標準出力に出力（元ファイルを保持）
- `-d`: 圧縮ファイルを展開（gunzipと同じ）
- `-r`: ディレクトリ内のファイルを再帰的に圧縮
- `-v`: 処理の詳細を表示（verbose）
- `-l`: 圧縮ファイルの情報を表示（list）
- `-[1-9]`: 圧縮率を指定（1が最速・最低圧縮、9が最遅・最高圧縮、デフォルトは6）

### 使用例
1. ファイルを圧縮（元ファイルは削除）：
```bash
gzip file.txt
# 結果：file.txt.gz が作成され、file.txt は削除される
```

2. ファイルを圧縮（元ファイルを保持）：
```bash
gzip -c file.txt > file.txt.gz
```

3. 圧縮ファイルの展開：
```bash
gzip -d file.txt.gz
# または
gunzip file.txt.gz
```

4. 最高圧縮率で圧縮：
```bash
gzip -9 file.txt
```

5. 圧縮ファイル情報の表示：
```bash
gzip -l file.txt.gz
```

### 特徴
- デフォルトでは圧縮後に元ファイルは削除される
- 元ファイルを保持するには `-c` オプションとリダイレクトを使用
- 圧縮ファイルの拡張子は自動的に `.gz` が付加される
- 単一ファイルの圧縮に特化（複数ファイルをまとめる場合は tar と組み合わせる）
- 圧縮率と処理速度のバランスを調整可能

### 注意点
- 既に圧縮されているファイル（.gz）に対して圧縮を試みるとエラーになる
- ディレクトリを直接圧縮することはできない（tarと組み合わせて使用する）
- 圧縮率を上げると処理時間が長くなる
- 展開時は自動的に元のファイル名に戻る

## 2. リダイレクト演算子の違い（> と >>）

リダイレクト演算子には `>` と `>>` の2種類があり、それぞれ異なる動作をします。

### 基本的な違い
- `>`: 上書きモード
  - ファイルが存在する場合、既存の内容を削除して新しい内容を書き込む
  - ファイルが存在しない場合、新規作成する
- `>>`: 追記モード
  - ファイルが存在する場合、既存の内容を保持したまま末尾に新しい内容を追記する
  - ファイルが存在しない場合、新規作成する

### 具体例での違い
```bash
# 例：rm ./* > rm.log の場合
# 1. 既存のrm.logがある場合、その内容は完全に削除される
# 2. 新しいログが書き込まれる

# 例：rm ./* >> rm.log の場合
# 1. 既存のrm.logの内容は保持される
# 2. 既存の内容の後ろに新しいログが追記される
```

### 使い分けのポイント
- `>` を使う場合：
  - 過去のログが不要で、新しいログだけを残したい場合
  - ファイルの内容を完全に置き換えたい場合

- `>>` を使う場合：
  - 過去のログも保持しておきたい場合
  - 履歴として記録を蓄積したい場合
  - 複数のコマンドの出力を1つのファイルにまとめたい場合

### 注意点
- `>` は既存のファイル内容を完全に消去するため、使用時は注意が必要
- 重要なファイルの場合、誤って `>` を使用しないよう注意
- ログファイルを扱う場合は、通常 `>>` を使用する方が安全
- `/dev/null` へのリダイレクト（`> /dev/null`）は出力を破棄する場合に使用

## 3. tarコマンド

tarは、複数のファイルやディレクトリをまとめて1つのアーカイブファイルを作成するためのコマンドです。名前の由来は"Tape ARchive"です。

### 基本的な書式
```bash
tar [オプション] [アーカイブファイル名] [対象ファイル/ディレクトリ]
```

### 主なオプション（操作モード）
- `-c`: アーカイブを新規作成（create）
- `-x`: アーカイブを展開（extract）
- `-t`: アーカイブの内容を一覧表示（list）
- `-r`: アーカイブにファイルを追加（append）
- `-u`: アーカイブ内のファイルを更新（update）

### 補助オプション
- `-f`: アーカイブファイル名を指定（ほぼ必須）
- `-v`: 処理の詳細を表示（verbose）
- `-p`: パーミッションを保持（preserve）
- `-P`: 絶対パスを許可
- `-C ディレクトリ`: 指定したディレクトリに移動してから処理

### 圧縮関連オプション
- `-z`: gzipで圧縮/展開（.tar.gz または .tgz）
- `-j`: bzip2で圧縮/展開（.tar.bz2）
- `-J`: xzで圧縮/展開（.tar.xz）

### よく使う組み合わせ
1. アーカイブの作成：
```bash
# 基本的なアーカイブ作成
tar -cf archive.tar file1 file2 dir1

# gzip圧縮付きでアーカイブ作成
tar -czf archive.tar.gz file1 file2 dir1

# 詳細表示付きでアーカイブ作成
tar -cvf archive.tar file1 file2 dir1
```

2. アーカイブの展開：
```bash
# 基本的な展開
tar -xf archive.tar

# gzip圧縮されたアーカイブの展開
tar -xzf archive.tar.gz

# 特定のディレクトリに展開
tar -xf archive.tar -C /path/to/directory
```

3. アーカイブの内容確認：
```bash
# アーカイブ内のファイル一覧表示
tar -tf archive.tar

# 詳細な一覧表示
tar -tvf archive.tar
```

### 特徴
- 複数のファイルやディレクトリを1つのファイルにまとめられる
- ファイルの属性（パーミッション、タイムスタンプなど）を保持
- 様々な圧縮形式と組み合わせ可能
- バックアップやソフトウェアの配布によく使用される

### 注意点
- `-f` オプションは必ずアーカイブファイル名の直前に置く
- 展開時は適切な圧縮オプション（-z、-j、-J）を指定する
- 展開先のディスク容量に注意
- 古いバージョンのtarでは、オプションの前のハイフン（-）が必須でしたが、現在のバージョンではハイフンの有無は問いません

## 4. ddコマンド

ddは、ブロック単位でファイルをコピー・変換するための低レベルなコマンドです。主にデバイスファイルの操作やバックアップに使用されます。

### 基本的な書式
```bash
dd [オプション] operand ...
```

### 主なオペランド
- `if=ファイル`: 入力ファイルを指定（input file）
- `of=ファイル`: 出力ファイルを指定（output file）
- `bs=バイト数`: 一度に読み書きするブロックサイズを指定（block size）
- `count=数`: コピーするブロック数を指定
- `skip=数`: 入力側でスキップするブロック数
- `seek=数`: 出力側でスキップするブロック数
- `conv=変換オプション`: データ変換方式を指定

### 主な変換オプション（conv=）
- `noerror`: エラー時に処理を継続
- `sync`: エラー時にブロックを0で埋める
- `notrunc`: 出力ファイルを切り詰めない
- `ucase`: 小文字を大文字に変換
- `lcase`: 大文字を小文字に変換
- `swab`: バイトの順序を入れ替え

### 使用例
1. イメージファイルの作成：
```bash
# USBメモリのイメージを作成
dd if=/dev/sdb of=usb_backup.img bs=4M

# CDのイメージを作成
dd if=/dev/cdrom of=cd_backup.iso bs=2048
```

2. デバイスの初期化：
```bash
# デバイスをゼロクリア
dd if=/dev/zero of=/dev/sdb bs=4M

# デバイスをランダムデータで上書き
dd if=/dev/urandom of=/dev/sdb bs=4M
```

3. ファイルの部分コピー：
```bash
# 最初の1MBをスキップして2MBコピー
dd if=input.file of=output.file bs=1M skip=1 count=2
```

4. 文字変換：
```bash
# ファイルの内容を大文字に変換
dd if=input.txt of=output.txt conv=ucase
```

### 特徴
- ブロック単位での低レベルなデータ操作が可能
- デバイスファイルの直接操作が可能
- バイト単位での精密なデータ操作
- システムバックアップやデータリカバリに利用
- ディスクのクローン作成に使用可能

### 注意点
- rootユーザーでの実行が必要な場合が多い
- 誤った使用でデータを破壊する可能性があるため、細心の注意が必要
- デバイスファイルの指定には特に注意が必要（ifとofを間違えると重大な問題発生）
- 大容量データの処理には時間がかかる
- 適切なブロックサイズ（bs）を指定すると処理が高速化される

## 5. rmdirコマンド

rmdirコマンドは空のディレクトリのみを削除することが出来るコマンドです。

### 基本的な書式
```bash
rmdir [-p] ディレクトリ名
```

### 主なオプション
- `-p`: ディレクトリ名に階層を指定した場合、削除するディレクトリの親ディレクトリを同時に削除するオプション

### 使用例
```bash
# 空のディレクトリを削除
rmdir empty_directory

# 階層構造のディレクトリを削除
# parent/child/が空の場合、両方のディレクトリを削除
rmdir -p parent/child
```

### 特徴
- 削除対象のディレクトリが空である必要がある
- ディレクトリ内にファイルやサブディレクトリがある場合は削除できない
- 空でないディレクトリを削除するには、rm -r コマンドを使用する必要がある
- 安全にディレクトリを削除するためのコマンド（誤って中身を削除することがない）

## LPICの出題ポイント
- gzipの基本的なオプションと動作の理解
- リダイレクト演算子（>と>>）の違いと使い分け
- tarコマンドの主なオプションとアーカイブ操作
- ddコマンドの基本的な使用方法とデバイス操作
- rmdirコマンドの制限と適切な使用シーン

## 参考資料
- Linux標準教科書（LPI）
- The Linux Command Line（William Shotts著）
- Man pages for gzip, tar, dd コマンド

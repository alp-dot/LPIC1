# コマンドラインでの作業

## 1. uname コマンド

システム情報を表示するコマンドです。オプションなしではOS名のみ表示されますが、`-a` オプションを使用すると、ホスト名、カーネルバージョン、ハードウェアの種類など、より詳細な情報が表示されます。

### 基本的な書式
```bash
uname [オプション]
```

### 主なオプション
- `-a`: すべての情報を表示（all）
- `-s`: カーネル名を表示（デフォルト）
- `-n`: ホスト名を表示（nodename）
- `-r`: カーネルリリース番号を表示（release）
- `-v`: カーネルバージョンを表示（version）
- `-m`: マシンハードウェア名を表示（machine）
- `-p`: プロセッサの種類を表示（processor）
- `-o`: オペレーティングシステム名を表示（operating-system）

### 使用例
```bash
# オペレーティングシステム名を表示
uname -s
# -> Linux

# すべてのシステム情報を表示
uname -a
# -> Linux hostname 5.15.0-76-generic #83-Ubuntu SMP ...

# カーネルリリース番号のみを表示
uname -r
# -> 5.15.0-76-generic
```

## 2. man コマンド

コマンドなどのオンラインマニュアルを参照するためのコマンドです。Linuxシステムの包括的なドキュメントとして機能します。

### 基本的な書式
```bash
man [オプション] [セクション] コマンド名
```

### manページのセクション
1. 実行可能プログラムまたはシェルコマンド
2. システムコール（カーネルが提供する関数）
3. ライブラリコール（プログラムライブラリの関数）
4. 特殊ファイル（通常は /dev にあるデバイス）
5. ファイルフォーマットと規約
6. ゲーム
7. その他（マクロパッケージや規約など）
8. システム管理コマンド（通常はroot専用）

### 主なオプション
- `-f コマンド名`: 指定したコマンドの短い説明を表示（whatisと同じ）
- `-k キーワード`: 指定したキーワードを含むmanページの一覧を表示（aproposと同じ）
- `-セクション番号`: 指定したセクションのmanページを表示

### 主な検索オプション
- `man -k キーワード`：キーワードを含むmanページを検索（aproposと同じ）
- `man -f キーワード`：完全一致するmanページを検索（whatisと同じ）

### 使用例
```bash
# sambaに関連するすべてのmanページを検索
man -k samba
apropos samba  # 上記と同じ結果

# samba名のmanページのみ検索
man -f samba
whatis samba   # 上記と同じ結果

# 特定のセクションのmanページを参照
man 5 passwd   # /etc/passwdファイルのフォーマットを表示
man 1 passwd   # passwdコマンドの使用方法を表示
```

### manページ内での操作
- `スペースキー`: 1ページ進む
- `b`: 1ページ戻る
- `f`: 1ページ進む（スペースと同じ）
- `/文字列`: 文字列を検索
- `n`: 次の検索結果へ
- `N`: 前の検索結果へ
- `q`: manページを終了

キーワードが曖昧な場合は`-k`オプションを、正確な名前が分かっている場合は`-f`オプションを使用します。

## 3. バッククォートとメタキャラクタ

シェルスクリプトで使用される特殊文字の使い方です。これらはコマンド実行や文字列操作に重要な役割を果たします。

### 主な特殊文字（メタキャラクタ）
- バッククォート（\`コマンド\`）：囲まれた文字列をコマンドとして実行し、その結果に置き換え
- `$(コマンド)`：バッククォートと同じ機能（こちらの方が推奨）
- バックスラッシュ（\\）：直後の文字を通常の文字として扱う（エスケープ）
- ドル記号（$）：変数の値を参照する
- アスタリスク（*）：任意の文字列に一致するワイルドカード
- クエスチョンマーク（?）：任意の1文字に一致するワイルドカード
- 角括弧（[abc]）：括弧内の任意の1文字に一致
- セミコロン（;）：複数のコマンドを1行に記述する区切り文字
- アンパサンド（&）：コマンドをバックグラウンドで実行
- パイプ（|）：左側のコマンドの出力を右側のコマンドの入力にする

### 使用例
```bash
# バッククォートの使用例
echo "現在のディレクトリは `pwd` です"

# $()の使用例（同じ結果）
echo "現在のディレクトリは $(pwd) です"

# ワイルドカードの使用例
ls *.txt       # 拡張子が.txtのファイルをリスト
ls file?.txt   # file1.txt, fileA.txtなどにマッチ
ls file[0-9].txt  # file0.txt〜file9.txtにマッチ

# 複数コマンドの実行
cd /tmp; ls -l; pwd

# バックグラウンド実行
find / -name "*.log" > logs.txt &
```

## 4. export コマンド

環境変数を設定するコマンドです。シェル間で変数を共有するために使用されます。

### 基本的な書式
```bash
export [オプション] [名前[=値] ...]
```

### 主なオプション
- `-p`: 現在の環境変数一覧を表示
- `-n`: 指定した変数を環境変数から削除（エクスポート解除）

### 基本的な使い方
```bash
export NAME=VALUE    # 環境変数の設定
export NAME          # 既存の変数を環境変数にする
export -p            # 現在の環境変数一覧を表示
export -n NAME       # 環境変数のエクスポート解除
```

### 主な用途
- パスの設定（PATH変数）
- 言語設定（LANG変数）
- シェルスクリプトでの変数共有
- デフォルトエディタの設定（EDITOR変数）
- メールボックスの指定（MAIL変数）

### 使用例
```bash
# PATHに新しいディレクトリを追加
export PATH=$PATH:/usr/local/newapp/bin

# 言語設定を日本語に変更
export LANG=ja_JP.UTF-8

# デフォルトエディタをvimに設定
export EDITOR=vim
```

設定した環境変数は、そのシェルから起動されたプログラムでも利用できます。ただし、親プロセスから子プロセスへの継承は可能ですが、子プロセスから親プロセスへは継承されません。

## 5. 変数の表示と設定

シェル変数や環境変数の内容を確認・設定するための方法です。

### 環境変数とシェル変数の違い
- **シェル変数**：現在のシェルでのみ有効
- **環境変数**：現在のシェルとそこから起動される子プロセスで有効

### シェル引数や変数の操作
引数や変数の操作について、以下のように考えてください。

- **引数や変数の参照**: 引数や変数の値を取得する場合には「$」を付けます。例えば、変数`LPIC`の値を参照したいときは`$LPIC`と書きます。このドルマークによって、シェルは変数の中身を取ってくることができます。

- **変数への値の設定**: 変数に新しい値を設定する場合には「$」を付けません。例えば、LPICという変数にtestという値を代入する場合は、LPIC=testと書きます。ここでは変数自体に直接働きかけていますので、ドルマークは不要です。

### 主なコマンド
- `set`：すべての変数（シェル変数と環境変数）を表示
- `env`：環境変数のみを表示
- `printenv`：環境変数のみを表示
- `echo $変数名`：指定した変数の値を表示
- `変数名=値`：変数を設定（シェル変数）
- `export 変数名=値`：環境変数を設定

### 主な環境変数
- `HOME`: ユーザーのホームディレクトリ
- `PATH`: コマンド検索パス
- `USER`: 現在のユーザー名
- `SHELL`: 現在使用しているシェル
- `LANG`: システムの言語・ロケール設定
- `PWD`: 現在の作業ディレクトリ
- `TERM`: 端末タイプ

### 使用例
```bash
echo $HOME         # HOME変数の値を表示
set | grep PATH    # PATH関連の変数を検索
MY_VAR="test"      # シェル変数の設定
echo $MY_VAR       # シェル変数の表示
export MY_VAR      # シェル変数を環境変数に昇格
printenv MY_VAR    # 環境変数として表示
```

シェル変数はそのシェルでのみ有効で、環境変数は子プロセスでも利用できます。

## 6. コマンド履歴

bashシェルは入力したコマンドの履歴を記録します。これにより過去に実行したコマンドを簡単に再利用できます。

### 主な環境変数
- `HISTFILE`：履歴を保存するファイル（通常は ~/.bash_history）
- `HISTFILESIZE`：履歴ファイルに保存するコマンド数（デフォルトは500）
- `HISTSIZE`：メモリ上に保持するコマンド数（デフォルトは500）
- `HISTCONTROL`：履歴の保存方法を制御（ignoredups=重複を無視）

### 主なコマンドと操作
- `history`：コマンド履歴の表示
- `history N`：最新のN件のみ表示
- `history -c`：履歴をクリア
- `!N`：履歴番号Nのコマンドを実行
- `!!`：直前のコマンドを再実行
- `!文字列`：その文字列で始まる最新のコマンドを実行
- `Ctrl+R`：履歴の逆方向検索
- `↑`/`↓`：履歴をブラウズ

### 使用例
```bash
history           # コマンド履歴の表示
history 10        # 最新の10件を表示
!42               # 履歴番号42のコマンドを実行
!!                # 直前のコマンドを再実行
!ls               # 最後に実行したlsコマンドを再実行
HISTSIZE=1000     # 履歴サイズを1000に変更
HISTCONTROL=ignoredups  # 重複したコマンドを履歴に残さない
history -c        # 履歴をクリア
```

### 履歴の活用テクニック
- **選択的な削除**: `history -d 数字` で特定の履歴を削除
- **コマンド置換**: `^old^new` で直前のコマンドのoldをnewに置換して実行
- **履歴展開**: `!$` で直前のコマンドの最後の引数を参照
- **範囲指定**: `!n1-n2` で履歴のn1からn2までを表示

履歴はログアウト時にファイルに保存され、次回ログイン時に読み込まれます。セキュリティ上重要なコマンド（パスワードなど）は履歴に残らないよう注意が必要です。

## 7. プロンプトのカスタマイズ

bashシェルのプロンプトは、`PS1`環境変数を変更することでカスタマイズできます。

### 主なプロンプト変数
- `PS1`: 通常のプロンプト
- `PS2`: 複数行入力時の継続プロンプト
- `PS3`: selectコマンドのプロンプト
- `PS4`: デバッグ時のプロンプト

### 主なエスケープシーケンス
- `\u`: 現在のユーザー名
- `\h`: ホスト名
- `\w`: カレントディレクトリ（フルパス）
- `\W`: カレントディレクトリ（ディレクトリ名のみ）
- `\d`: 日付
- `\t`: 時刻
- `\$`: 一般ユーザーなら$、rootなら#
- `\n`: 改行
- `\[` と `\]`: 表示されない制御シーケンスの開始と終了

### カラー設定
```bash
# カラーコード
# 30:黒, 31:赤, 32:緑, 33:黄, 34:青, 35:マゼンタ, 36:シアン, 37:白
# 背景色は40-47

# 赤色のプロンプト
PS1='\[\033[31m\]\u@\h:\w\$\[\033[0m\] '

# 緑色のユーザー名、青色のパス
PS1='\[\033[32m\]\u\[\033[0m\]@\h:\[\033[34m\]\w\[\033[0m\]\$ '
```

### 使用例
```bash
# 基本的なプロンプト
PS1='\u@\h:\w\$ '

# 時刻を含むプロンプト
PS1='[\t] \u@\h:\w\$ '

# 複数行プロンプト
PS1='\u@\h\n\w\$ '

# カラープロンプト（ユーザー名が緑）
PS1='\[\033[32m\]\u\[\033[0m\]@\h:\w\$ '
```

設定したプロンプトを永続化するには、`.bashrc`ファイルに追加します。

## LPICの出題ポイント
- unameコマンドの基本的なオプションと使用法
- manページのセクションとその内容
- 環境変数とシェル変数の違いと設定方法
- bash履歴機能の基本的な使用法と設定変数
- シェルのメタキャラクタとその意味・使用法
- exportコマンドの役割と使用方法

---

## 参考資料
- Linux標準教科書（LPI）
- The Linux Command Line（William Shotts著）
- Linux Man Pages（man-pages プロジェクト）
- GNU Bash マニュアル

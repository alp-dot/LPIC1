# フィルターを使用してのテキストストリーム処理

## 1. ODコマンド（Octal Dump）

ODコマンドは、ファイルの内容を様々な形式（8進数、16進数、ASCII文字など）で表示するためのコマンドです。主にバイナリファイルの内容を確認する際に使用されます。

### 基本的な書式
```bash
od [オプション] [ファイル名]
```

### 主なオプション
- `-t c` または `-c`: ASCII文字とエスケープシーケンスで表示
- `-t x`: 16進数で表示
- `-t o`: 8進数で表示（デフォルト値）
- `-t d`: 10進数で表示
- `-A d`: オフセット値を10進数で表示
- `-N バイト数`: 指定したバイト数だけ表示

### 使用例
1. ASCII文字とエスケープシーケンスでファイルを表示：
```bash
od -c /bin/ls
```

2. 16進数表示で先頭100バイトのみ表示：
```bash
od -t x -N 100 /bin/ls
```

3. 10進数オフセットでASCII文字表示：
```bash
od -A d -c /etc/passwd
```

### 特徴
- バイナリファイルを人間が読める形式に変換
- ファイルの内容を詳細に分析可能
- 各行の先頭にはファイルの先頭からのオフセット（位置）を表示
- デバッグやファイルフォーマットの解析に便利
- 制御文字や非表示文字の確認に役立つ

## 2. trコマンド

trコマンドは、標準入力から受け取ったテキストの文字を変換または削除するためのコマンドです。

### 基本的な書式
```bash
tr [オプション] [文字列1 [文字列2]]
```

または、ファイルを使用する場合：
```bash
cat ファイル名 | tr [オプション] [文字列1 [文字列2]]
tr [オプション] [文字列1 [文字列2]] < ファイル名
```

### 主な文字クラス
- `[:space:]`: スペース、タブ、改行などの空白文字
- `[:digit:]`: 数字（0-9）
- `[:upper:]`: 大文字（A-Z）
- `[:lower:]`: 小文字（a-z）
- `[:alpha:]`: アルファベット（a-zA-Z）
- `[:alnum:]`: アルファベットと数字（a-zA-Z0-9）
- `[:cntrl:]`: 制御文字
- `[:punct:]`: 句読点文字

### 主なオプション
- `-d`: 指定した文字を削除
- `-s`: 指定した文字の連続を1つに圧縮（squeeze）
- `-c`: 指定した文字以外を処理対象とする（complement）

### 使用例
1. 連続したスペースを1つに圧縮：
```bash
cat file.txt | tr -s [:space:]
```

2. 大文字を小文字に変換：
```bash
echo "HELLO" | tr [:upper:] [:lower:]
```

3. 数字を削除：
```bash
echo "abc123xyz456" | tr -d [:digit:]
```

4. 改行をスペースに変換：
```bash
cat file.txt | tr '\n' ' '
```

5. 文字列から特定の文字以外を削除：
```bash
echo "Hello, World!" | tr -cd '[:alpha:]'  # アルファベットのみ残す
```

### 特徴
- 標準入力からのみデータを受け付ける（ファイル名を直接指定不可）
- パイプやリダイレクトと組み合わせて使用
- 文字クラスを使用して柔軟な文字変換が可能
- 文字の変換、削除、圧縮などの基本的なテキスト処理に有用
- 複雑な置換処理はsedコマンドを使用

## 3. sortコマンド

sortコマンドは、テキストファイルの内容を行単位でソートするためのコマンドです。

### 基本的な書式
```bash
sort [オプション] [ファイル名...]
```

### 主なオプション
- `-n`: 数値としてソート
- `-r`: 逆順（降順）でソート
- `-k 数字`: 指定した列（フィールド）でソート
- `-t 文字`: フィールドの区切り文字を指定
- `-u`: 重複行を削除してソート（unique）
- `-f`: 大文字小文字を区別しない（fold）
- `-b`: 先頭の空白を無視（ignore-leading-blanks）
- `-o ファイル`: 結果を指定したファイルに出力
- `-m`: すでにソートされたファイルをマージ
- `-c`: ファイルがソート済みかどうかを確認

### 使用例
1. 基本的なソート：
```bash
sort file.txt
```

2. 数値でソート：
```bash
sort -n numbers.txt
```

3. カンマ区切りファイルの2列目で数値ソート：
```bash
sort -t',' -k2 -n data.csv
```

4. 重複を削除して逆順ソート：
```bash
sort -ur names.txt
```

5. 先頭の空白を無視して大文字小文字区別なしでソート：
```bash
sort -bf text.txt
```

6. ソート結果をファイルに保存：
```bash
sort -n numbers.txt -o sorted_numbers.txt
```

### 特徴
- 行単位でソートを実行
- 複数のファイルを同時に処理可能
- 標準入力からのソートも可能
- デフォルトは文字列としての辞書順ソート
- 大量のデータも効率的に処理可能
- 複数キーによるソートも可能

## 4. 行番号を付けるコマンド

### nlコマンド
テキストファイルに行番号を付けて出力するためのコマンドです。

#### 基本的な書式
```bash
nl [オプション] [ファイル名]
```

#### 主なオプション
- `-b a`: 全ての行に行番号を付ける（all）
- `-b t`: 空行以外の行に行番号を付ける（デフォルト）
- `-n ln`: 行番号を左詰めで表示（left-justified）
- `-n rn`: 行番号を右詰めで表示（デフォルト）
- `-w 数字`: 行番号の表示幅を指定（width）
- `-s 文字列`: 行番号と本文の間の区切り文字を指定（default: タブ）

### catコマンド（行番号表示機能）
catコマンドも行番号を付けて表示することができます。

#### 基本的な書式
```bash
cat [オプション] [ファイル名...]
```

#### 行番号関連のオプション
- `-n`: 全ての行に行番号を付ける
- `-b`: 空行以外の行に行番号を付ける
- `-E`: 各行の末尾に「$」記号を表示（行末の空白を可視化）
- `-T`: タブ文字を「^I」として表示
- `-A`: -vET と同じ（非表示文字と行末を表示）

### 使用例
1. 空行以外に行番号を付ける（nlコマンド）：
```bash
nl file.txt
```

2. 空行以外に行番号を付ける（catコマンド）：
```bash
cat -b file.txt
```

3. 全ての行に行番号を付ける：
```bash
nl -b a file.txt
# または
cat -n file.txt
```

4. 行番号の幅を指定して左詰めで表示：
```bash
nl -w 3 -n ln file.txt
```

### 特徴
- nlコマンドはより柔軟な行番号表示が可能
- catコマンドはシンプルな行番号表示に適している
- どちらも空行の扱いを選択可能
- nlコマンドは行番号の表示形式をカスタマイズ可能
- catコマンドは複数のファイルを連結表示する機能も持つ

## 5. grepコマンド

grepコマンドは、テキストファイルから指定したパターンに一致する行を検索するためのコマンドです。名前の由来は "Global Regular Expression Print" の略です。

### 基本的な書式
```bash
grep [オプション] パターン [ファイル名...]
```

### 主なオプション
- `-i`: 大文字小文字を区別せずに検索（ignore-case）
- `-v`: パターンに一致しない行を表示（invert-match）
- `-n`: 行番号も表示
- `-r` または `-R`: ディレクトリを再帰的に検索
- `-l`: パターンを含むファイル名のみ表示
- `-c`: パターンに一致した行数を表示（count）
- `-E`: 拡張正規表現を使用（egrepと同等）
- `-F`: 正規表現ではなく固定文字列として検索（fgrepと同等）
- `-w`: 単語全体が一致する行のみ表示（word）
- `-A 数字`: 一致した行の後の指定行数も表示（after）
- `-B 数字`: 一致した行の前の指定行数も表示（before）
- `-C 数字`: 一致した行の前後の指定行数も表示（context）

### 使用例
1. 基本的な検索：
```bash
grep "pattern" file.txt
```

2. 複数ファイルからの検索：
```bash
grep "pattern" file1.txt file2.txt
```

3. 大文字小文字を区別せずに検索：
```bash
grep -i "pattern" file.txt
```

4. ディレクトリ内を再帰的に検索：
```bash
grep -r "pattern" /path/to/directory
```

5. 一致箇所の前後の行も表示：
```bash
grep -C 2 "pattern" file.txt  # 前後2行ずつ表示
```

6. 一致する単語のみ検索（部分一致を除外）：
```bash
grep -w "word" file.txt
```

### 正規表現の基本
- `.`: 任意の1文字にマッチ
- `^`: 行の先頭にマッチ
- `$`: 行の末尾にマッチ
- `[abc]`: 括弧内の任意の1文字にマッチ
- `[^abc]`: 括弧内の文字以外の任意の1文字にマッチ
- `*`: 直前の文字の0回以上の繰り返しにマッチ
- `\`: エスケープ文字
- `\{n\}`: 直前の文字がn回繰り返しにマッチ
- `\{n,m\}`: 直前の文字がn回からm回の繰り返しにマッチ
- `\<`: 単語の先頭にマッチ
- `\>`: 単語の末尾にマッチ

### 拡張正規表現（-Eオプション使用時）
- `+`: 直前の文字の1回以上の繰り返しにマッチ
- `?`: 直前の文字の0回または1回の出現にマッチ
- `|`: 選択（OR）を表す
- `()`: グループ化

### 特徴
- テキスト検索の標準的なツール
- パイプラインと組み合わせて柔軟に使用可能
- 強力な正規表現検索に対応
- 大量のテキストデータから情報を抽出するのに適している
- 検索結果は標準出力に出力される

## 6. その他のテキスト処理コマンド

### cutコマンド
ファイルから列（カラム）を抽出するコマンドです。

#### 基本的な書式
```bash
cut [オプション] [ファイル名]
```

#### 主なオプション
- `-c 番号,番号-番号`: 指定した位置の文字を抽出
- `-f 番号,番号-番号`: 指定したフィールド（列）を抽出
- `-d 文字`: フィールドの区切り文字を指定（デフォルトはタブ）

#### 使用例
```bash
# /etc/passwdから1列目と5列目を抽出（区切り文字は:）
cut -d: -f1,5 /etc/passwd

# 各行の1文字目から10文字目までを抽出
cut -c1-10 file.txt
```

### uniqコマンド
隣接する重複行を除去するコマンドです。

#### 基本的な書式
```bash
uniq [オプション] [入力ファイル [出力ファイル]]
```

#### 主なオプション
- `-c`: 各行の出現回数も表示
- `-d`: 重複する行のみ表示
- `-u`: 重複しない行のみ表示
- `-i`: 大文字小文字を区別しない

#### 使用例
```bash
# 重複行を除去して表示（sortと組み合わせて使用するのが一般的）
sort file.txt | uniq

# 各行の出現回数を表示
sort file.txt | uniq -c

# 重複する行のみ表示
sort file.txt | uniq -d
```

### wcコマンド
ファイル内の行数、単語数、バイト数をカウントするコマンドです。

#### 基本的な書式
```bash
wc [オプション] [ファイル名...]
```

#### 主なオプション
- `-l`: 行数のみ表示(line)
- `-w`: 単語数のみ表示(word)
- `-c`: バイト数のみ表示(character/byte)
- `-m`: 文字数のみ表示(multibyte character)

#### 使用例
```bash
# ファイルの行数、単語数、バイト数を表示
wc file.txt

# ファイルの行数のみを表示
wc -l file.txt
```

### teecコマンド
標準入力から読み込んだデータを、ファイルと標準出力の両方に出力するコマンドです。

#### 基本的な書式
```bash
コマンド | tee [オプション] ファイル名
```

#### 主なオプション
- `-a`: ファイルに追記モードで書き込む

#### 使用例
```bash
# コマンドの出力をファイルに保存しつつ、画面にも表示
ls -l | tee file_list.txt

# コマンドの出力を既存ファイルに追記しつつ、画面にも表示
echo "new line" | tee -a file.txt
```

## LPICの出題ポイント
- 各コマンドの基本的な使い方とオプション
- 正規表現の基本と応用
- パイプとリダイレクトを使ったフィルタコマンドの連携
- テキスト処理における各コマンドの適切な選択
- データの抽出、整形、集計に関する問題

---

## 参考資料
- Linux標準教科書（LPI）
- GNU Coreutils マニュアル
- GNU grep マニュアル
- Pro Bash Programming（Apress）
